<!--miniprogram/pages/doctor/doctor.wxml-->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <block wx:if="{{loading}}">
    <view class="loading">åŠ è½½ä¸­...</view>
  </block>

  <!-- ç©ºçŠ¶æ€ -->
  <block wx:elif="{{empty}}">
    <view class="empty-state">
      <view class="empty-icon">ğŸ“‹</view>
      <view class="empty-text">æš‚æ— è®°å½•æ•°æ®</view>
      <view class="empty-hint">è¯·å…ˆæ·»åŠ ä¸€æ¡è®°å½•</view>
    </view>
  </block>

  <!-- æœ‰æ•°æ® -->
  <block wx:else>
    <!-- ç»Ÿè®¡èŒƒå›´åˆ‡æ¢ -->
    <view class="range-selector">
      <view 
        class="range-item {{rangeDays === 7 ? 'active' : ''}}"
        data-days="7"
        bindtap="changeRange">
        è¿‘7å¤©
      </view>
      <view 
        class="range-item {{rangeDays === 14 ? 'active' : ''}}"
        data-days="14"
        bindtap="changeRange">
        è¿‘14å¤©
      </view>
      <view 
        class="range-item {{rangeDays === 30 ? 'active' : ''}}"
        data-days="30"
        bindtap="changeRange">
        è¿‘30å¤©
      </view>
    </view>

    <!-- æ‘˜è¦å¡ç‰‡ -->
    <view class="summary-card" wx:if="{{summary}}">
      <!-- æƒ…ç»ªç»Ÿè®¡ -->
      <view class="summary-section" wx:if="{{summary.mood && summary.mood.count > 0}}">
        <view class="section-title">æƒ…ç»ªè¯„åˆ†</view>
        <view class="section-content">
          <view>å¹³å‡ï¼š{{summary.mood.avg}}</view>
          <view>èŒƒå›´ï¼š{{summary.mood.min}} - {{summary.mood.max}}</view>
          <view>è®°å½•æ•°ï¼š{{summary.mood.count}}</view>
        </view>
      </view>

      <!-- ç¡çœ ç»Ÿè®¡ -->
      <view class="summary-section" wx:if="{{summary.sleep}}">
        <view class="section-title">ç¡çœ æ—¶é•¿</view>
        <view class="section-content">
          <view>å¹³å‡ï¼š{{summary.sleep.avgHours}} å°æ—¶</view>
          <view>èŒƒå›´ï¼š{{summary.sleep.minHours}} - {{summary.sleep.maxHours}} å°æ—¶</view>
          <view>è®°å½•æ•°ï¼š{{summary.sleep.count}}</view>
        </view>
      </view>

      <!-- ç”¨è¯ç»Ÿè®¡ -->
      <view class="summary-section" wx:if="{{summary.meds}}">
        <view class="section-title">ç”¨è¯æƒ…å†µ</view>
        <view class="section-content">
          <view wx:if="{{summary.meds.names.length > 0}}">
            è¯ç‰©ï¼š{{summary.meds.names.join('ã€')}}
          </view>
          <view wx:if="{{summary.meds.changed}}">ï¼ˆæœŸé—´æœ‰ç”¨è¯å˜æ›´ï¼‰</view>
          <view wx:if="{{summary.meds.complianceRate !== null}}">
            ä¾ä»æ€§ï¼š{{summary.meds.complianceRate}}%
          </view>
        </view>
      </view>

      <!-- å‰¯ä½œç”¨ -->
      <view class="summary-section" wx:if="{{summary.sideEffectsTop.length > 0}}">
        <view class="section-title">å¸¸è§å‰¯ä½œç”¨</view>
        <view class="section-content">
          {{summary.sideEffectsTop.join('ã€')}}
        </view>
      </view>

      <!-- é£é™©æç¤º -->
      <view class="risk-warning" wx:if="{{summary.hasRisk}}">
        âš ï¸ å­˜åœ¨é£é™©æ ‡è®°ï¼Œè¯·é‡ç‚¹å…³æ³¨
      </view>

      <!-- å¤‡æ³¨ -->
      <view class="summary-section" wx:if="{{summary.notes.length > 0}}">
        <view class="section-title">å¤‡æ³¨è®°å½•</view>
        <view class="section-content">
          <view wx:for="{{summary.notes}}" wx:key="index" class="note-item">
            <view class="note-date">{{item.date}}</view>
            <view class="note-text">{{item.note}}</view>
          </view>
        </view>
      </view>
    </view>
  </block>
</view>

