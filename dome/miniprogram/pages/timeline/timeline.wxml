<!-- miniprogram/pages/timeline/timeline.wxml -->
<view style="padding:16px;background:#f6f6f6;min-height:100vh;">

<!-- æ ‡é¢˜ -->
<view style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
  <view style="font-size:20px;font-weight:700;">å¤è¯Šæ—¶é—´è½´</view>
</view>

<!-- è¿‡æ»¤æŒ‰é’® -->
<view style="display:flex;gap:10px;margin-bottom:12px;">
  <view
    data-filter="all"
    bindtap="setFilter"
    style="padding:10px 14px;border-radius:10px;font-weight:600;
           background:{{filter==='all' ? '#e8f5e9' : '#fff'}};
           color:{{filter==='all' ? '#2e7d32' : '#333'}};
           border:1px solid {{filter==='all' ? '#b7e1c0' : '#eee'}};">
    å…¨éƒ¨
  </view>

  <view
    data-filter="daily"
    bindtap="setFilter"
    style="padding:10px 14px;border-radius:10px;font-weight:600;
           background:{{filter==='daily' ? '#e8f5e9' : '#fff'}};
           color:{{filter==='daily' ? '#2e7d32' : '#333'}};
           border:1px solid {{filter==='daily' ? '#b7e1c0' : '#eee'}};">
    æ¯æ—¥è®°å½•
  </view>

  <view
    data-filter="lab"
    bindtap="setFilter"
    style="padding:10px 14px;border-radius:10px;font-weight:600;
           background:{{filter==='lab' ? '#e8f5e9' : '#fff'}};
           color:{{filter==='lab' ? '#2e7d32' : '#333'}};
           border:1px solid {{filter==='lab' ? '#b7e1c0' : '#eee'}};">
    æ£€æŸ¥/å¤æŸ¥
  </view>
</view>

<!-- å¿«æ·å…¥å£ -->
<view style="display:flex;gap:12px;margin-bottom:14px;">
  <view
    bindtap="goIndex"
    style="flex:1;background:#fff;border:1px solid #eee;border-radius:12px;
           padding:12px;font-weight:700;color:#2e7d32;text-align:center;">
    å»å¡«å†™ä»Šæ—¥è®°å½•
  </view>

  <view
    bindtap="goAddLab"
    style="flex:1;background:#fff;border:1px solid #eee;border-radius:12px;
           padding:12px;font-weight:700;color:#2e7d32;text-align:center;">
    æ·»åŠ æ£€æŸ¥/å¤æŸ¥ï¼ˆä¸‹ä¸€æ­¥åšï¼‰
  </view>
</view>

<!-- åˆ—è¡¨ -->
<block wx:if="{{items.length === 0}}">
  <view style="background:#fff;border:1px solid #eee;border-radius:16px;padding:18px;color:#999;">
    æš‚æ— è®°å½•
    <view style="margin-top:8px;font-size:12px;color:#bbb;">
      ä½ å¯ä»¥å…ˆå»é¦–é¡µä¿å­˜ä¸€æ¡â€œæƒ…ç»ª + ç¡çœ â€è®°å½•ï¼Œæ—¶é—´è½´å°±ä¼šè‡ªåŠ¨å‡ºç°ã€‚
    </view>
  </view>
</block>

<block wx:else>
  <view wx:for="{{items}}" wx:key="key" style="margin-bottom:12px;">

    <!-- ========== æ¯æ—¥è®°å½•å¡ç‰‡ ========== -->
    <block wx:if="{{item.type === 'daily'}}">
      <view style="background:#fff;border:1px solid #eee;border-radius:16px;padding:16px;">

        <!-- å¡ç‰‡æ ‡é¢˜è¡Œ -->
        <view style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
          <view style="font-size:16px;font-weight:800;">ğŸ—“ï¸ æ¯æ—¥è®°å½•</view>
          <view style="font-size:12px;color:#666;">{{item.date}}</view>
        </view>

        <!-- ä¸»ä¿¡æ¯ -->
        <view style="font-size:14px;color:#111;line-height:1.8;">
          <view>æƒ…ç»ªï¼š{{item.moodText}}</view>
          <view>ç¡çœ ï¼š{{item.sleepText}}</view>
          <view>ç¡çœ é—®é¢˜ï¼š{{item.sleepIssuesText}}</view>

          <view style="margin-top:6px;">ç”¨è¯æ–¹æ¡ˆï¼š{{item.planText}}</view>
          <view>ä¾ä»æ€§ï¼š{{item.takeMedText}}</view>

          <view style="margin-top:6px;">
            ä¸é€‚/å‰¯ä½œç”¨ï¼š{{item.sideEffectsText}}
            <text style="color:#999;">ã€€ä¸¥é‡åº¦ï¼š{{item.sideEffectSeverityText}}</text>
          </view>

          <block wx:if="{{item.sideEffectNote}}">
            <view style="color:#666;">å¤‡æ³¨ï¼š{{item.sideEffectNote}}</view>
          </block>
        </view>

        <!-- æ—¶é—´ -->
        <block wx:if="{{item.timeText}}">
          <view style="margin-top:10px;font-size:12px;color:#999;">
            {{item.timeText}}
          </view>
        </block>

      </view>
    </block>

    <!-- ========== æ£€æŸ¥/å¤æŸ¥å¡ç‰‡ ========== -->
    <block wx:elif="{{item.type === 'lab'}}">
      <view style="background:#fff;border:1px solid #eee;border-radius:16px;padding:16px;">

        <view style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
          <view style="font-size:16px;font-weight:800;">ğŸ§ª æ£€æŸ¥/å¤æŸ¥</view>
          <view style="font-size:12px;color:#666;">{{item.date}}</view>
        </view>

        <view style="font-size:14px;color:#111;line-height:1.8;">
          <view>ç±»å‹ï¼š{{item.labType}}</view>
          <block wx:if="{{item.hospital}}">
            <view>åŒ»é™¢ï¼š{{item.hospital}}</view>
          </block>
          <block wx:if="{{item.note}}">
            <view>å¤‡æ³¨ï¼š{{item.note}}</view>
          </block>

          <block wx:if="{{item.images && item.images.length}}">
            <view style="margin-top:6px;color:#666;">å·²ä¸Šä¼ å›¾ç‰‡ï¼š{{item.images.length}} å¼ </view>
          </block>
        </view>

        <block wx:if="{{item.timeText}}">
          <view style="margin-top:10px;font-size:12px;color:#999;">
            {{item.timeText}}
          </view>
        </block>

      </view>
    </block>

    <!-- ========== å…œåº•å¡ç‰‡ ========== -->
    <block wx:else>
      <view style="background:#fff;border:1px solid #eee;border-radius:16px;padding:16px;color:#999;">
        æœªè¯†åˆ«çš„æ•°æ®ç±»å‹
      </view>
    </block>

  </view>
</block>

<!-- åº•éƒ¨ç•™ç™½ -->
<view style="height:20px;"></view>
</view>